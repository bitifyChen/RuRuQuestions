import{r as y,e as $,c as a,o as d,a as r,h as g,i as m,t as b,b as _,u as E,j,v as S,w as I,k as D,F as M,l as O,n as w}from"./index-DGx74SFh.js";import{T as U,r as z,u as x}from"./xlsx-DUbICNJn.js";const H={class:"space-y-6"},L={class:"flex space-x-4"},W={class:"p-6 rounded-2xl bg-white/30 backdrop-blur-md border border-white/40 shadow-lg flex-1 transition-transform hover:scale-[1.01]"},q={key:0,class:"mt-4 text-gray-700 text-center text-sm tracking-wide select-text"},G={class:"font-semibold"},J={key:0,class:"p-6 rounded-2xl bg-white/30 backdrop-blur-md border border-white/40 shadow-lg flex-1 flex items-center justify-center hover:scale-[1.01]"},K={class:"text-center space-y-2"},P={class:"flex items-center justify-center space-x-2 text-red-500"},Q={class:"text-5xl font-extrabold text-red-700"},X={key:0,class:""},Y={key:1,class:"overflow-auto border border-white/40 rounded-2xl bg-white/30 backdrop-blur-md shadow-lg"},Z={class:"min-w-full border-collapse text-gray-800"},ee=["title"],te={key:0,class:"border border-white/20 px-4 py-2 text-red-600 font-black"},re={key:1,class:"border border-white/20 px-4 py-2"},ne={__name:"index",setup(se){const v=y(""),u=y([]),i=y(!1),R=$(()=>u.value.map((t,e)=>({originalIndex:e,displayIndex:e+2,...t})).filter(t=>!i.value||t.error));function A(t){t["!merges"]&&t["!merges"].forEach(({s:e,e:o})=>{var c;const s=x.encode_cell(e),l=((c=t[s])==null?void 0:c.v)??"";for(let n=e.r;n<=o.r;++n)for(let f=e.c;f<=o.c;++f){const p=x.encode_cell({r:n,c:f});t[p]||(t[p]={t:"s",v:l})}})}function k(t){return!t||t.toString().trim()===""?"五通號欄位不可為空":t.toString().length!==18?"五通號欄位長度必須為 18":""}function B(t){const e={},o=x.decode_range(t["!ref"]),s=o.s.r;for(let l=o.s.c;l<=o.e.c;++l){const c=x.encode_cell({r:s,c:l}),n=t[c];n&&n.v&&(e[n.v]=l)}return e}function N(t){const e=t.target.files[0];if(!e)return;v.value=e.name;const o=new FileReader;o.onload=s=>{const l=new Uint8Array(s.target.result),c=z(l,{type:"array"}),n=[];c.SheetNames.forEach(f=>{const p=c.Sheets[f];A(p);const V=x.sheet_to_json(p,{defval:""});B(p),V.forEach((C,F)=>{({...C},Object.entries(C).forEach(([T,h])=>{T.includes("五通號")&&(k(h),h&&n.push({sheet:f,rowIndex:F+2,value:h,message:"1212",error:k(h)}))}))})}),u.value=n},o.readAsArrayBuffer(e),t.target.value=""}return(t,e)=>{const o=D;return d(),a("section",H,[r("div",L,[r("div",W,[e[4]||(e[4]=r("label",{for:"file-upload",class:"block mb-4 text-xl font-bold text-gray-700 text-center select-none"}," 選擇 Excel 檔案 (.xlsx, .xls) ",-1)),r("input",{ref:"fileInput",id:"file-upload",type:"file",accept:".xlsx,.xls",onChange:N,class:"hidden"},null,544),r("button",{onClick:e[0]||(e[0]=s=>t.$refs.fileInput.click()),class:"w-full py-3 rounded-xl bg-gradient-to-r from-indigo-400 to-purple-500 text-white font-semibold shadow hover:from-purple-500 hover:to-indigo-400 transition-all duration-300"}," 選擇檔案 "),v.value?(d(),a("p",q,[e[3]||(e[3]=m(" 已選擇：")),r("span",G,b(v.value),1)])):g("",!0)]),u.value.length?(d(),a("div",J,[r("div",K,[r("div",P,[_(E(U),{class:"w-6 h-6 opacity-80"}),e[5]||(e[5]=r("span",{class:"text-xl font-semibold"},"錯誤欄位總數",-1))]),r("div",Q,b(u.value.filter(s=>s.error).length),1)])])):g("",!0)]),u.value.length?(d(),a("div",X,[j(_(o,{type:"danger",round:"",onClick:e[1]||(e[1]=s=>i.value=!i.value)},{default:I(()=>e[6]||(e[6]=[m("只顯示錯誤")])),_:1,__:[6]},512),[[S,!i.value]]),j(_(o,{type:"primary",round:"",onClick:e[2]||(e[2]=s=>i.value=!i.value)},{default:I(()=>e[7]||(e[7]=[m("顯示所有")])),_:1,__:[7]},512),[[S,i.value]])])):g("",!0),u.value.length?(d(),a("div",Y,[r("table",Z,[e[8]||(e[8]=r("thead",{class:"bg-purple-200/50 sticky top-0 text-gray-800 text-sm"},[r("tr",null,[r("th",{class:"border border-white/20 px-4 py-2 text-left"},"分頁"),r("th",{class:"border border-white/20 px-4 py-2 text-left"},"位置"),r("th",{class:"border border-white/20 px-4 py-2 text-left"},"五通號"),r("th",{class:"border border-white/20 px-4 py-2 text-left"},"錯誤原因")])],-1)),r("tbody",null,[(d(!0),a(M,null,O(E(R),(s,l)=>(d(),a("tr",{key:l,class:"even:bg-white/20 odd:bg-white/10 transition-all hover:bg-white/40"},[r("td",{class:w(["border border-white/20 px-4 py-2 font-black",{"border-red-500 text-red-700 font-black":s.error}])},b(s.sheet),3),r("td",{class:w(["border border-white/20 px-4 py-2 font-black",{"border-red-500 text-red-700 font-black":s.error}])},b(s.rowIndex),3),r("td",{class:w(["border border-white/20 px-4 py-2",{"border-red-500 bg-red-200/30 text-red-700 font-black":s.error}]),title:s.error},b(s.value||""),11,ee),s.error?(d(),a("td",te,b(s.error),1)):(d(),a("td",re))]))),128))])])])):g("",!0)])}}};export{ne as default};
